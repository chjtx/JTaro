/*! JTaro.js v0.4.4 ~ (c) 2016 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.JTaro=e()}(this,function(){"use strict";function t(t){return t.replace(/\/|\\/g,"__")}function e(){return Object.create({add:function(t,e){this[t]=e},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}var n,o,i;document.addEventListener("touchstart",function(t){n=t,i=t.timeStamp,o=!!/^AUDIO|BUTTON|VIDEO|SELECT|INPUT|TEXTAREA$/.test(t.target.tagName)},!0),document.addEventListener("touchmove",function(){o=!0},!0),document.addEventListener("touchend",function(t){if(!o&&t.timeStamp-i<300){t.preventDefault(),t.stopPropagation();var e=new MouseEvent("click",{bubbles:!0,cancelable:!0});return document.activeElement.blur(),n.target.dispatchEvent(e),!1}},!0);var r=Object.create(null);return r.beforeEnter=e(),r.afterEnter=e(),r.beforeLeave=e(),r.tools={isEmptyObject:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}},r.install=function(e,n){function o(t,e){var n=t.options.beforeEnter;r.beforeEnter.run(),"function"==typeof n?n.call(r,function(t){e(t)})&&e():e()}function i(n){var o=e.options.components[t(n.jtaro_tag)].options.afterEnter;r.afterEnter.run(),"function"==typeof o&&o.call(n.$children[0],r.tools.isEmptyObject(r.params)?null:r.params),r.params=null}function a(n,o){var i=e.options.components[t(n.$parent.jtaro_tag)].options.beforeLeave;r.beforeLeave.run(),"function"==typeof i?i.call(n,function(){o()})&&o():o()}function s(t,e){var n=t.$el,o=n.previousElementSibling;r.method&&r.method.call(t.$children[0],t.$children[0]),r.sliding=!0,e.utils.moveTo(n,m,0),setTimeout(function(){o&&e.utils.moveTo(o,-m*r.options.distance,0,r.options.duration,function(){var t=o.previousElementSibling;t&&(t.style.display="none")}),e.utils.moveTo(n,0,0,1===r.views.length?0:r.options.duration,function(){r.sliding=!1,i(t)})},0)}function l(t,e,n){var o=t.nextElementSibling;r.sliding=!0,o&&e.utils.moveTo(o,m,0,r.options.duration,n),e.utils.moveTo(t,0,0,r.options.duration,function(){r.sliding=!1;var e=t.previousElementSibling;e&&(e.style.display="block")})}function d(t,e,n,o){var a=t.length;a-1>o&&l(e[a-2],n,function(){t.splice(a-1),r.history.splice(a-1),window.sessionStorage.setItem("JTaro.history",JSON.stringify(r.history)),e[a-1].parentNode.removeChild(e[a-1]),setTimeout(function(){d(t,e,n,o)},0)}),a-1===o&&i(c(t[o]))}function u(t){var e=t.split("&"),n={};return e.forEach(function(t){var e=t.split("=");n[e[0]]=e[1]}),n}function c(t){for(var e=r.vm.$children,n=0,o=e.length;n<o;n++)if(e[n].jtaro_tag===t)return e[n]}function p(t,e){var n=t.replace("#","").split("?")[0],o=r.vm.$data.views,i=r.views.indexOf(n),a=c(n);i===-1?(o.indexOf(n)===-1?o.push(n):(r.vm.$el.appendChild(a.$el),s(a,e)),r.views.push(n),r.history.push({view:n,url:t.replace("#",""),params:r.tools.isEmptyObject(r.params)?null:r.params}),window.sessionStorage.setItem("JTaro.history",JSON.stringify(r.history))):(r.method&&r.method.call(a,a),d(r.views,r.vm.$el.childNodes,e,i))}function f(){m=window.innerWidth}function h(){var n=window.location.hash,i=e.options.components[t(n.replace("#","").split("?")[0]||r.options.default)];i&&o(i,function(t){if(t?r.method=t:r.method=null,""===n)window.location.hash=r.options.default;else{var e=n.split("?");r.params={},e[1]&&(r.params=u(e[1])),p(n,r.options.JRoll)}})}var v=document.getElementById("jtaro_style");v||(v=document.createElement("style"),v.id="jtaro_style",v.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff;-webkit-box-shadow: rgba(0,0,0,.3) -5px 0 8px;box-shadow: rgba(0,0,0,.3) -5px 0 8px;}",document.head.appendChild(v));var m=window.innerWidth;n=n||{},r.views=[],r.history=[],r.version="0.4.4",r.options={JRoll:n.JRoll||window.JRoll,el:n.el||"#jtaro_app",default:n.default||"home",distance:n.distance||.3,duration:n.duration||200};var w={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(n){return n(e.options.components[t(this.view)])},mounted:function(){s(this,r.options.JRoll)}};e.component("jt-view",w),e.prototype.postMessage=function(n,o){var i=c(o),r=e.options.components[t(o)],a=r?r.options.onMessage:null;i&&a&&a.call(i.$children[0],{message:n,origin:this.$parent.jtaro_tag})},e.prototype.go=function(n,i){function s(t){for(;!t.$el.classList.contains("jtaro-view");)t.$parent&&(t=t.$parent);return t}r.sliding||a(s(this),function(){var a=n.replace("#",""),s=a.split("?");o(e.options.components[t(s[0])],function(t){var e,o,a=r.views.indexOf(s[0]);if(~a&&(a=1-(r.views.length-a),a&&(n=a)),t?r.method=t:r.method=null,r.params={},i&&(r.params=i),s[1]){o=u(s[1]);for(e in o)o.hasOwnProperty(e)&&(r.params[e]=o[e])}"number"==typeof n?window.history.go(n):window.location.hash=n})})},r.vm=new e({el:r.options.el,data:{views:[]},template:'<div id="'+r.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){p(window.location.hash,r.options.JRoll)}),window.addEventListener("resize",f),window.addEventListener("orientationchange",f);var g=window.sessionStorage.getItem("JTaro.history");r.afterEnter.add("__autoLoadHistoryPages__",function(){if(g&&g.length>1){var t=c(g.shift().view).$children[0];setTimeout(function(){t.go(g[0].url,g[0].params)},0)}}),g&&(g=JSON.parse(g)).length>1?window.history.go(1-g.length):h()},r});