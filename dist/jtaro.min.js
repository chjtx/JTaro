/*! JTaro.js v0.7.0 ~ (c) 2016-2018 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.JTaro=n()}(this,function(){"use strict";function w(t){return t.replace(/\/|\\/g,"__")}var y=Object.create(null);function t(){return Object.create({add:function(t,n){this[t]=n},remove:function(t){delete this[t]},run:function(){for(var t in this)this.hasOwnProperty(t)&&"function"==typeof this[t]&&this[t]()}})}return y.beforeEnter=t(),y.afterEnter=t(),y.beforeLeave=t(),y.tools={isEmptyObject:function(t){for(var n in t)if(t.hasOwnProperty(n))return!1;return!0}},y.install=function(s,t){var p=window.innerWidth,a="",r=!1;t=t||{},y.views=[],y.history=[],y.version="0.7.0",y.options={JRoll:t.JRoll||window.JRoll,el:t.el||"#jtaro_app",default:t.default||"home",distance:isNaN(t.distance)?.2:Number(t.distance),duration:isNaN(t.duration)?300:Number(t.duration),vueOptions:t.vueOptions||{}};var n=document.getElementById("jtaro_style");function l(t,n){var o=t.options.beforeEnter;y.beforeEnter.run(),"function"==typeof o?o.call(y,function(t){n(t)})&&n():n()}function u(t){var n=s.options.components[w(t.jtaro_tag)].options.afterEnter;y.afterEnter.run(),"function"==typeof n&&n.call(t.$children[0],y.tools.isEmptyObject(y.params)?null:y.params),y.params=null}function d(){for(var t=y.history.length,n=window.location.hash.replace("#","").split("?")[0];t--;)if(y.history[t].url===n)return void(window.location.hash=a);window.history.back()}function c(t,n){var o=t.$el,e=o.previousElementSibling;y.method&&y.method.call(t.$children[0],y.tools.isEmptyObject(y.params)?null:y.params),y.sliding=!0,o.style[n.utils.TSD]="0ms",o.style[n.utils.TSF]="translate("+p+"px, 0px) translateZ(0px)",setTimeout(function(){o.style[n.utils.TSD]="",e&&(e.style[n.utils.TSF]="translate("+-p*y.options.distance+"px, 0px) translateZ(0px)",setTimeout(function(){var t=e.previousElementSibling;t&&(t.style.display="none")},y.options.duration)),o.style[n.utils.TSF]="translate(0px, 0px) translateZ(0px)",setTimeout(function(){y.sliding=!1,u(t)},1===y.views.length?0:y.options.duration)},100)}function f(t,n,o,e){var i,s,a,r,l=t.length;e<l-1?(l-2===e&&y.method&&y.method.call(m(t[e]).$children[0],y.tools.isEmptyObject(y.params)?null:y.params),i=n[l-2],s=o,a=function(){t.splice(l-1),y.history.splice(l-1),n[l-1].parentNode.removeChild(n[l-1]),setTimeout(function(){f(t,n,o,e)},0)},r=i.nextElementSibling,y.sliding=!0,r&&(r.style[s.utils.TSF]="translate("+p+"px, 0px) translateZ(0px)",setTimeout(a,y.options.duration)),i.style[s.utils.TSF]="translate(0px, 0px) translateZ(0px)",setTimeout(function(){y.sliding=!1;var t=i.previousElementSibling;t&&(t.style.display="block")},y.options.duration)):u(m(t[e]))}function h(t){var n=t.split("&"),o={};return n.forEach(function(t){var n=t.split("=");o[n[0]]=n[1]}),o}function m(t){for(var n=y.vm.$children,o=0,e=n.length;o<e;o++)if(n[o].jtaro_tag===t)return n[o]}function v(t,n){var o=t.replace("#","").split("?")[0],e=y.vm.$data.views,i=y.views.indexOf(o),s=m(o);a=o,-1===i?(-1===e.indexOf(o)?e.push(o):(y.vm.$el.appendChild(s.$el),c(s,n)),y.views.push(o),y.history.push({view:o,url:t.replace("#",""),params:y.tools.isEmptyObject(y.params)?null:y.params})):f(y.views,y.vm.$el.childNodes,n,i)}function o(){p=window.innerWidth}n||((n=document.createElement("style")).id="jtaro_style",n.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff;-webkit-transition:transform "+y.options.duration+"ms ease-out;transition:transform "+y.options.duration+"ms ease-out;}",document.head.appendChild(n));var e={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(t){return t(s.options.components[w(this.view)])},mounted:function(){c(this,y.options.JRoll)}};s.component("jt-view",e),s.prototype.postMessage=function(t,n){var o=m(n),e=s.options.components[w(n)],i=e?e.options.onMessage:null;o&&i&&i.call(o.$children[0],{message:t,origin:this.$parent.jtaro_tag})},s.prototype.go=function(t,n){if(!y.sliding){if(!isNaN(t))return void window.history.go(t);var o,e,i=t.replace("#","").split("?"),s=y.views.indexOf(i[0]);if(~s&&(s=1-(y.views.length-s))&&(t=s),y.params={},n&&(y.params=n),i[1])for(o in e=h(i[1]))e.hasOwnProperty(o)&&(y.params[o]=e[o]);"number"==typeof t?window.history.go(t):window.location.hash=t}};var i=Object.assign(y.options.vueOptions.data||{},{views:[]});y.vm=new s(Object.assign(y.options.vueOptions,{el:y.options.el,data:i,render:function(n){return n("div",{attrs:{id:y.options.el.replace("#","")}},[this.views.map(function(t){return n("jt-view",{staticClass:"jtaro-view",props:{view:t,key:t}})})])}})),window.addEventListener("hashchange",function(){if(r)r=!1;else if(""!==window.location.hash){var t,n,o,e=window.location.hash.replace("#","").split("?")[0];a?(t=m(a),n=function(){l(s.options.components[w(e)],i)},o=s.options.components[w(t.jtaro_tag)].options.beforeLeave,y.beforeLeave.run(),"function"==typeof o?(r=!0,o.call(t.$children[0],function(){r=!1,n()},d)):n()):l(s.options.components[w(e)],i)}else window.location.hash=y.options.default;function i(t){y.method=t||null,v(window.location.hash,y.options.JRoll)}}),window.addEventListener("resize",o),window.addEventListener("orientationchange",o);!function(t){var o=window.location.hash;if(t&&window.location.hash.substr(1)!==y.options.default)window.location.hash=y.options.default;else if(""!==o){var n=o.replace("#","").split("?")[0],e=s.options.components[w(n)];e&&l(e,function(t){y.method=t||null;var n=o.split("?");y.params={},n[1]&&(y.params=h(n[1])),v(o,y.options.JRoll)})}else window.location.hash=y.options.default}(1)},y});